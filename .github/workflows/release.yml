# DO NOT EDIT! Generated by eval-github-yaml from .github/workflows/release.ncl
{
  "jobs": {
    "tarball": {
      "name": "Upload Release Tarball",
      "runs-on": "ubuntu-latest",
      "steps": [
        {
          "uses": "actions/checkout@v3"
        },
        {
          "name": "Installing Nix",
          "uses": "cachix/install-nix-action@v22",
          "with": {
            "extra_nix_config": "experimental-features = nix-command flakes",
            "nix_path": "nixpkgs=channel:nixos-unstable"
          }
        },
        {
          "name": "Setup Cachix",
          "uses": "cachix/cachix-action@v12",
          "with": {
            "authToken": "${{ secrets.CACHIX_TWEAG_NICKEL_AUTH_TOKEN }}",
            "name": "tweag-nickel"
          }
        },
        {
          "name": "Create Release Tarball",
          "run": "nix build .#release --print-build-logs"
        },
        {
          "env": {
            "GH_TOKEN": "${{ github.token }}",
            "RELEASE_TAG": "${{ github.event_name == 'release' && github.event.release.tag_name || github.event.inputs.release_tag }}"
          },
          "name": "Upload Release Tarball",
          "run": "gh release upload --clobber $RELEASE_TAG ./result/tf-ncl.tar.xz#\"Generated Tf-Ncl Schemas\""
        }
      ]
    }
  },
  "name": "Release",
  "on": {
    "release": {
      "types": [
        "created"
      ]
    },
    "workflow_dispatch": {
      "inputs": {
        "release_tag": {
          "description": "The release tag to target"
        }
      }
    }
  }
}
